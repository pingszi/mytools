{% extends base_template %}
{% load i18n %}

{% load xadmin_tags %}

{% block extrastyle %}
<style type="text/css">
    .btn-toolbar{margin-top: 0;}
    #content-block.full-content{margin-left: 0;}
</style>
{% endblock %}
{% block bodyclass %}change-list{% endblock %}

{% block nav_title %}{% if brand_icon %}<i class="{{brand_icon}}"></i> {% endif %}{{brand_name}}{% endblock %}

{% block nav_toggles %}
{% include "xadmin/includes/toggle_menu.html" %}
{% endblock %}

{% block nav_btns %}

{% endblock nav_btns %}

{% block content %}
<div class="container">
    <div class="row clearfix">
        <div class="col-md-6 column">
            <div id="expense_details_month_statis" style="width: 100%;height: 300px"></div>
        </div>
        <div class="col-md-6 column">
            <div id="expense_details_month_type_statis" style="width: 100%;height: 330px"></div>
        </div>
    </div>
</div>
<script src="/static/echarts/echarts.min.js"></script>
<script src="/static/common/js/common.js"></script>
<script src="/static/common/js/base_chart.js"></script>
<script>
    $(document).ready(function(){
        init();
    });

    //**初始化
    function init() {
        let params = {}
        params.fields = "date_format(expense_date, '%Y-%m') name,d.name type,sum(value) value";
        params.table = "bill_bus_expense_details ed left join bill_bas_data d on ed.type_id = d.id";
        params.group = "date_format(expense_date, '%Y-%m'),d.name";
        params.order = "date_format(expense_date, '%Y-%m')";
        let pileBar = new PileBar("expense_details_month_statis", params, "type");
        pileBar.show().then(baseData => {
            params = {};
            params.fields = "d.name,sum(ed.value) value";
            params.table = "bill_bus_expense_details ed left join bill_bas_data d on ed.type_id = d.id";
            params.where = `date_format(ed.expense_date, '%Y-%m') = '${baseData[0].name}'`;
            params.group = "d.name";
            let basePie = new BasePie("expense_details_month_type_statis", params);
            basePie.show();

            //**鼠标移入
            pileBar.getEChart().on('mouseover', json => {
                params.where = `date_format(ed.expense_date, '%Y-%m') = '${json.name}'`;
                basePie.setOption({series: [{name: json.name}]});
                basePie.show();
            });
        });
    }
</script>
{% endblock %}